<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="utility.js"></script>
    <link rel="stylesheet" href="./test.css">
</head>
<body >
    
    <div id="view_container" style="height: 100%; width:100%;">

        <svg >
  
        </svg>

    </div>

    
    

    <script >

            let test_start = new Date()

            // variables
            let min_in_day = 1440 //used to calculate viewer

            // set up viewer
            let svg = document.querySelector('svg')
            let view_container = document.querySelector('#view_container')
            let current_view_width =  view_container.offsetHeight
            let current_view_height = view_container.offsetWidth
            
            svg.setAttribute('height', current_view_height); //set view height
            svg.setAttribute('width', '100%');  //set view width
            svg.setAttribute('viewBox',"0 -20 1445 300") // set points in svg viewer
            svg.offsetWidth = current_view_width;
            svg.offsetHeight = current_view_height;
        
            let html = '' //svg html output 

            let readings_a_day = 96 // number of expected readings per day

            // sample generated dat
            var full_data = [
                // ["2011-10-05T14:48:00.000Z", 15.5],            
                // ["2011-10-05T14:48:00.000Z", 15.5],            

            ]

            let number_of_days = 30 //numbers of days in data set


            // create fact data set
            for (let index = 0; index < number_of_days; index++) {

                let data = []

                for (let index = 0; index < readings_a_day; index++) {
                    let v  = ["2011-10-05T14:48:00.000Z", getRandomInt(-60, 60)]
                    data.push( v )
                }

                let output = [ index, data ]
                full_data.push( output )    
            }

            console.log(full_data);
         
            // generatalize each step position
            let reading_steps = min_in_day / readings_a_day
            let current_x_position = 0

            // calculate oppacity
            // let oppacity_set = 1 / ( number_of_days * 4 )

            // let oppacity_first_value = Math.pow(-1, -2)

            // console.log(oppacity_set);
            let current_oppacity = 0
            console.log(current_oppacity);

            full_data.forEach((bundle, full_data_key) => {
                // handle date and time timestamp


                // console.log(bundle);


                let current_data = bundle[1]; // complete time stamp
                let current_day //track the current day being handled
                let current_poliline = '' // contain the current line for the current day as its being built
                let output_html = '' // output 


                //for the current day 
                current_data.forEach((data, key) => {

                    let data_reading = data[1]
                    let full_date = data[0]
                    let date_time_sections = full_date.split("T"); // split date and time
                    let date = date_time_sections[0] //current reading date
                    let time_n_zone = date_time_sections[1] // crrent reading full time
                    let  time_n_zone_sections = time_n_zone.split("."); // split date and time
                    let time = time_n_zone_sections[0] //current time 
                    let time_zone = time_n_zone_sections[1] //current times time zone iso offset
                    


                    // handle time sections
                    let time_sections = time.split(":") //split time sections at the ":"
                    let hour =  time_sections[0] // the hour for this current reading
                    let minute =  time_sections[1] // the minute for this current reading

                    // handle date sections

                    // // check if its the first number
                    // if (!current_day) {
                    //     console.log('im first');
                    //     current_day  = date
                    // }

                    // // check if its the same day
                    // if (current_day) {
                    //     console.log('next');
                    // }

                    // // check if its not the same days 
                    // if (current_day != date ) {
                    //     console.log('new day!');
                    // }

                    // handle device reading  ie the y postion
                    reading = data_reading
                    // console.log(reading);

                    //next setp the x position
                    current_x_position += reading_steps


                    
                    
                    // bundle poliline export 
                    let bundle_output = ` ${current_x_position},${reading}`  
                    current_poliline += bundle_output

                    // console.log(current_x_position);
                    // console.log(data[1]);
                
                    // reset current x position at the end of the cycle 
                    if (key === readings_a_day - 1 ) {
                        current_x_position = 0

                        //net step current opacity
                        current_oppacity = Math.pow( full_data.length -  full_data_key, -2)
                        console.log(current_oppacity);
                        
                        // second last number in series
                        if (current_oppacity === 1) {
                            console.log('last value');
                        }
                       
                                      
                    }
                    
                    

                
                });




                output_html = `
                <polyline 
                    points="${current_poliline}"
                    style="fill:none;stroke:black;stroke-width:3"
                    stroke-opacity="${current_oppacity}"
                    />
                    `
                
                html += output_html //place current finished poliline into the viewer


            });

            svg.innerHTML = html;

            let test_end = new Date()
            // console.log(dateDiffInDays(test_start, test_end));
            console.log('hi>?')
    </script>
</body>
</html>